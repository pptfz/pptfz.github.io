[toc]



# awkåŒ¹é…æ¨¡å¼

# ä¸€ã€æ­£åˆ™è¡¨è¾¾å¼

## 1.1åŒ¹é…è®°å½•(æ•´è¡Œ)

```python
//åŒ¹é…/etc/passwdæ–‡ä»¶ä¸­ä»¥rootå¼€å¤´çš„
[root@7-test1 ~]# awk '/^root/' /etc/passwd
root:x:0:0:root:/root:/bin/bash
            
[root@7-test1 ~]# awk '$0 ~/^root/' /etc/passwd
root:x:0:0:root:/root:/bin/bash
```



## 1.2åŒ¹é…å­—æ®µ	åŒ¹é…æ“ä½œç¬¦(~|!~)

```python
//åŒ¹é…/etc/passwdæ–‡ä»¶ä¸­ç¬¬ä¸€åˆ—ä»¥rootå¼€å¤´çš„
[root@7-test1 ~]# awk '$1~/^root/' /etc/passwd
root:x:0:0:root:/root:/bin/bash
            
//åŒ¹é…/etc/passwdæ–‡ä»¶ä¸­æœ€åä¸€åˆ—ä¸æ˜¯ä»¥bashç»“å°¾çš„
[root@7-test1 ~]# awk '$NF !~ /bash$/' /etc/passwd|head -5
bin:x:1:1:bin:/bin:/sbin/nologin
daemon:x:2:2:daemon:/sbin:/sbin/nologin
adm:x:3:4:adm:/var/adm:/sbin/nologin
lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin
sync:x:5:0:sync:/sbin:/bin/sync
```



## ^å’Œ~ç”¨æ³•ç¤ºä¾‹ 

> **^ åœ¨awkä¸­è¡¨ç¤ºä»¥...å¼€å¤´çš„åˆ—ï¼Œåœ¨sedã€grepä¸­è¡¨ç¤ºä»¥...å¼€å¤´çš„è¡Œ**

### ^ç”¨æ³•ç¤ºä¾‹

**ç¤ºä¾‹ï¼šæ‰“å°æ–‡ä»¶ä¸­ä»¥1å¼€å¤´çš„è¡Œ**

```python
//æ–‡ä»¶å†…å®¹
[root@7-test1 awk]# cat t.txt 
1 101,hehe,CEO
2 102,haha,CTO
3 103,xixi,COO
4 105,yy,CFO
5 106,xx,CIO
6 110,jjxx,COCO

[root@7-test1 awk]# awk '/^1/{print}' t.txt 
1 101,hehe,CEO
```



### ï½ç”¨æ³•ç¤ºä¾‹

```python
//æ–‡ä»¶å†…å®¹
[root@7-test1 awk]# cat t1.txt 
zhang  san  1234567    :550:100:175
li     si   88883336   :155:90:201
wang   wu   66666666   :250:60:50
zhao   liu  67676798   :150:80:75
hao    qi   11112222   :250:100:175
zhu    ba   000098763  :50:95:135


//æ˜¾ç¤ºæ‰€æœ‰IDå·ç æœ€åä¸€ä½æ˜¯2æˆ–7çš„äººçš„å…¨å
[root@7-test1 awk]# awk '$3~/[27]$/{print $1,$2}' t1.txt
zhang san
hao qi


//æ˜¾ç¤ºæ–‡ä»¶ä¸­ç¬¬ä¸‰åˆ—ä»¥1å¼€å¤´çš„è¡Œ
[root@7-test1 awk]# awk '$3~/^1/{print}' t1.txt 
zhang san
hao qi

//æ˜¾ç¤ºzhangçš„å§“æ°å’ŒIDå·ç 
[root@7-test1 awk]# awk '$1~/zhang/{print $1,$3}' t1.txt 
zhang 1234567

//æ˜¾ç¤ºzhangçš„ææ¬¾ï¼Œæ¯ä¸ªå€¼éƒ½ä»¥$å¼€å¤´ï¼Œå¦‚$250$100$175
æ–¹æ³•ä¸€ï¼š
[root@7-test1 awk]# awk -vFS='[ :]+' -vOFS=$ '$1~/zhang/{print "$"$4,$5,$NF}' t1.txt 
$550$100$175

æ–¹æ³•äºŒï¼š
awkæ›¿æ¢å‡½æ•°gsub
gsub    å…¨å±€æ›¿æ¢    awkå†…ç½®å‘½ä»¤(å‡½æ•°)
ä½¿ç”¨æ–¹æ³•
gsub(//,"",$n)  nè¡¨ç¤ºæ•°å­—
gsub(/æ‰¾è°/,"æ›¿æ¢ä¸ºä»€ä¹ˆ",æ›¿æ¢å“ªä¸€åˆ—)

[root@7-test1 awk]# awk '$1~/zhang/{gsub(/:/,"$",$NF);print $1,$NF}' t1.txt 
zhang $550$100$175
```



# äºŒã€æ¡ä»¶è¡¨è¾¾å¼

## 2.1å…³ç³»è¿ç®—ç¬¦

| è¿ç®—ç¬¦ | å«ä¹‰             |
| ------ | ---------------- |
| **<**  | **å°äº**         |
| **<=** | **å°äºç­‰äº**     |
| **==** | **ç­‰äº**         |
| **!=** | **ä¸ç­‰äº**       |
| **>**  | **å¤§äº**         |
| **>=** | **å¤§äºç­‰äº**     |
| **~**  | **æ¨¡ç³ŠåŒ¹é…**     |
| **!~** | **æ¨¡ç³ŠåŒ¹é…å–å** |

## 2.2ç¤ºä¾‹

**ç¤ºä¾‹1:æ‰“å°ç¬¬ä¸€åˆ—å¤§äº3çš„è¡Œ**

```python
//æ–‡ä»¶å†…å®¹
[root@7-test1 awk]# cat t.txt 
1 101,hehe,CEO
2 102,haha,CTO
3 103,xixi,COO
4 105,yy,CFO
5 106,xx,CIO
6 110,jjxx,COCO

[root@7-test1 awk]# awk '{if($1>3)print}' t.txt 
4 105,yy,CFO
5 106,xx,CIO
6 110,jjxx,COCO
```

**ç¤ºä¾‹2:æ˜¾ç¤ºç£ç›˜ä½¿ç”¨ç‡å¤§äº10%çš„ç£ç›˜åˆ†åŒºå’ŒæŒ‚è½½ç‚¹**

```python
[root@7-test1 awk]# df -h
Filesystem               Size  Used Avail Use% Mounted on
/dev/mapper/centos-root   17G  2.4G   15G  14% /
devtmpfs                 224M     0  224M   0% /dev
tmpfs                    236M     0  236M   0% /dev/shm
tmpfs                    236M  9.6M  226M   5% /run
tmpfs                    236M     0  236M   0% /sys/fs/cgroup
/dev/sda1               1014M  132M  883M  14% /boot
tmpfs                     48M     0   48M   0% /run/user/0

[root@7-test1 awk]# df -h|awk -F'[% ]+' 'NR>1 && $5>10{print $1,$5"%",$NF}'
/dev/mapper/centos-root 14% /
/dev/sda1 14% /boot
```

**ç¤ºä¾‹3:è®¡ç®—å†…å­˜ä½¿ç”¨ç‡**

```python
centOS6
//centOS6æŸ¥çœ‹å†…å­˜ä½¿ç”¨ç‡
[root@test1 ~]# free -m
             total       used       free     shared    buffers     cached
Mem:           474        171        303          0         30         44
-/+ buffers/cache:         95        378
Swap:         1023          0       1023
//centOS6è®¡ç®—å†…å­˜ä½¿ç”¨ç‡
[root@test1 ~]# free -m|awk 'NR==3{print $3/($3+$4)*100"%"}'
20.296%

centOS7
//centOS7æŸ¥çœ‹å†…å­˜ä½¿ç”¨ç‡
[root@7-test1 awk]# free -m
              total        used        free      shared  buff/cache   available
Mem:            470          90         243           5         136         330
Swap:          2047           0        2047
//centOS7è®¡ç®—å†…å­˜ä½¿ç”¨ç‡
[root@7-test1 awk]# free -m|awk 'NR==2{print ($2-$NF)/$2*100"%"}'
30%
```

**ç¤ºä¾‹4:åŒæ—¶è®¡ç®—å†…å­˜ä½¿ç”¨ç‡å’Œç©ºé—²ç‡**

```python
centOS6
//centOS6è®¡ç®—å†…å­˜ä½¿ç”¨ç‡å’Œç©ºé—²ç‡
[root@test1 ~]# free -m|awk 'NR==3{print $3/($3+$4)*100"%",$NF/($3+$NF)*100"%"}'
20.4641% 79.5359%

centOS7
//centOS7è®¡ç®—å†…å­˜ä½¿ç”¨ç‡å’Œç©ºé—²ç‡
[root@7-test1 ~]# free -m|awk 'NR==2{print ($2-$NF)/$2*100"%",$NF/$2*100"%"}'
30% 70%
```

## 2.3awkçš„ä¸€ä¸ªå‘

**âš ï¸âš ï¸âš ï¸awkä¼šæŠŠæ•°å­—å½“æˆå­—ç¬¦å¤„ç†**

```python
//æŸ¥çœ‹ç£ç›˜ä½¿ç”¨ç‡
[root@test1 ~]# df -h
Filesystem      Size  Used Avail Use% Mounted on
/dev/sda3        19G  2.4G   16G  14% /
tmpfs           238M     0  238M   0% /dev/shm
/dev/sda1       190M   35M  146M  19% /boot

//æ‰“å°ç¬¬äºŒè¡Œç¬¬5åˆ—å°äº9çš„åˆ—ï¼Œç»“æœä¸æ­£ç¡®
[root@test1 ~]# df -h|awk 'NR>1 && $5<9{print $1,$5,$NF}'
/dev/sda3 14% /
tmpfs 0% /dev/shm
/dev/sda1 19% /boot

å› ä¸ºawkä¼šæŠŠæ•°å­—å½“æˆå­—ç¬¦å¤„ç†ï¼Œæ¯”å¦‚sort
å¦‚ä¸‹æ‰€ç¤ºï¼Œsortä¼šæŠŠæ•°å­—å½“æˆå­—ç¬¦å¤„ç†ï¼Œå¹¶æ²¡æœ‰æŠŠæ•°å­—ä»å¤§åˆ°å°æ’åº
[root@test1 ~]# seq 15|sort
1
10
11
12
13
14
15
2
3
4
5
6
7
8
9



è§£å†³awkæŠŠæ•°å­—å½“æˆå­—ç¬¦å¤„ç†é—®é¢˜æ–¹æ³•ä¸€
ç”¨æŒ‡å®šåˆ†éš”ç¬¦çš„æ–¹å¼æŠŠæ•°å­—å’Œ%åˆ†å‰²å¼€
//æ­£ç¡®è¾“å‡º
[root@test1 ~]# df -h|awk -F'[% ]+'  '$5<9{print $1,$5,$NF}'
tmpfs 0 /dev/shm

//ä¸æ­£ç¡®è¾“å‡º
[root@test1 ~]# df -h|awk '$5<9{print $1,$5,$NF}'
/dev/sda3 14% /
tmpfs 0% /dev/shm
/dev/sda1 19% /boot


è§£å†³awkæŠŠæ•°å­—å½“æˆå­—ç¬¦å¤„ç†é—®é¢˜æ–¹æ³•äºŒ
è®©awkçŸ¥é“è¿›è¡Œæ•°å­—æ¯”è¾ƒï¼ŒæŸä¸€åˆ—åŠ 0
//æ­£ç¡®è¾“å‡º
[root@test1 ~]# df -h|awk 'NR>1 && $5+0<9{print $1,$5,$NF}'
tmpfs 0% /dev/shm

//ä¸æ­£ç¡®è¾“å‡º
[root@test1 ~]# df -h|awk 'NR>1 && $5<9{print $1,$5,$NF}'
/dev/sda3 14% /
tmpfs 0% /dev/shm
/dev/sda1 19% /boot
```



# ä¸‰ã€è¿ç®—è¡¨è¾¾å¼

**ç¤ºä¾‹1:æ‰“å°/etc/passwdç¬¬ä¸‰åˆ—ä¸10ç›¸ä¹˜å¤§äº5000çš„å†…å®¹**

```python
[root@test1 ~]# awk -F: '$3 * 10 > 5000' /etc/passwd
polkitd:x:999:998:User for polkitd:/:/sbin/nologin
chrony:x:998:996::/var/lib/chrony:/sbin/nologin
mysql:x:1000:1000::/home/mysql:/sbin/nologin
```

**ç¤ºä¾‹2ï¼šæ‰“å°/etc/passwdç¬¬ä¸‰åˆ—ä¸10ç›¸ä¹˜å¤§äº500çš„å†…å®¹ï¼Œå¹¶æ‰“å°ç¬¬ä¸€åˆ—å’Œç¬¬ä¸‰åˆ—**

```python
[root@test1 ~]# awk -F: 'BEGIN{OFS="--"} { if($3*10>5000) {print $1,$3} } END {print "æ‰“å°ok"}' /etc/passwd
polkitd--999
chrony--998
mysql--1000
æ‰“å°ok
```

**ç¤ºä¾‹3:åŠ ã€å‡ã€ä¹˜ã€é™¤ã€å–æ¨¡ã€å¹‚è¿ç®—**

```python
//æ–‡ä»¶test.txtå†…å®¹å¦‚ä¸‹
[root@test1 ~]# cat test.txt 
a 1 2 3 4 5
b 1 2 3 4 5
a 5 6 7 8 9

[root@test1 ~]# awk '/a/{print $2+10}' test.txt 
11
15
[root@test1 ~]# awk '/a/{print $2-10}' test.txt 
-9
-5
[root@test1 ~]# awk '/a/{print $2*10}' test.txt 
10
50
[root@test1 ~]# awk '/a/{print $2/10}' test.txt 
0.1
0.5
[root@test1 ~]# awk '/a/{print $2%10}' test.txt 
1
5
[root@test1 ~]# awk '/a/{print $2**10}' test.txt 
1
9765625
```



# å››ã€é€»è¾‘æ“ä½œç¬¦å’Œå¤åˆæ¨¡å¼

## 4.1é€»è¾‘æ“ä½œç¬¦

| ç¬¦å·     | å«ä¹‰       |
| -------- | ---------- |
| **&&**   | **é€»è¾‘ä¸** |
| **\|\|** | **é€»è¾‘æˆ–** |
| **ï¼**   | **é€»è¾‘é** |

**ç¤ºä¾‹1:æ‰“å°/etc/passwdæ–‡ä»¶ä¸­ç”¨æˆ·åä¸ºrootå¹¶ä¸”æ‰“å°uidå°äº15çš„è¡Œ**

```python
//æ–‡ä»¶ä¸­ç¬¬ä¸‰åˆ—æ˜¯UID
[root@test1 ~]# awk -F: '$1~/root/ && $3<=1' /etc/passwd 
root:x:0:0:root:/root:/bin/bash
```

**ç¤ºä¾‹2:æ‰“å°ç”¨æˆ·åä¸ºrootæˆ–ç¬¬ä¸‰åˆ—å¤§äº500çš„è¡Œ**

```python
[root@test1 ~]# awk -F: '$1~/root/ || $3>=500' /etc/passwd
root:x:0:0:root:/root:/bin/bash
polkitd:x:999:998:User for polkitd:/:/sbin/nologin
chrony:x:998:996::/var/lib/chrony:/sbin/nologin
mysql:x:1000:1000::/home/mysql:/bin/false
```

## 4.2ä¸‰å…ƒè¿ç®—ç¬¦

**ä¸‰å…ƒè¿ç®—ç¬¦è¡¨è¾¾å¼**

> **ä¸‰å…ƒè¿ç®—ç¬¦çš„å½¢å¼1ï¼š[ ç»“æœ = æ¡ä»¶ ? ç»“æœ1ï¼šç»“æœ2 ]**
>
> **ä¸‰å…ƒè¿ç®—ç¬¦çš„å½¢å¼2ï¼š[ æ¡ä»¶ ï¼Ÿ è¡¨è¾¾å¼1 ï¼š è¡¨è¾¾å¼2 ]**

**ç¤ºä¾‹ï¼š**

```python
//æ–‡ä»¶t.txtå†…å®¹å¦‚ä¸‹
[root@test1 ~]# cat t.txt 
student1 98
student2 99
student3 93
student4 78
student5 85

æ ¹æ®å­¦ç”Ÿæˆç»©åˆ¤æ–­å­¦ç”Ÿæˆç»©æ˜¯å¦ä¸ºä¼˜ç§€ï¼Œè¿™é‡Œè§„å®šåˆ†æ•°å¤§äº90æ˜¯ä¼˜ç§€ï¼Œä½äº90éä¼˜ç§€
//éä¸‰å…ƒè¿ç®—å†™æ³•
[root@test1 ~]# awk '{if($2>90){print $1,"ä¼˜ç§€"}else{print $1,"ä¸ä¼˜ç§€"}}' t.txt 
student1 ä¼˜ç§€
student2 ä¼˜ç§€
student3 ä¼˜ç§€
student4 ä¸ä¼˜ç§€
student5 ä¸ä¼˜ç§€


//ä¸‰å…ƒè¿ç®—å†™æ³•ä¸€		ç»“æœ = æ¡ä»¶ ? ç»“æœ1ï¼šç»“æœ2
[root@test1 ~]# awk '{res=$2>90?"ä¼˜ç§€":"ä¸ä¼˜ç§€";print $1,res}' t.txt 
student1 ä¼˜ç§€
student2 ä¼˜ç§€
student3 ä¼˜ç§€
student4 ä¸ä¼˜ç§€
student5 ä¸ä¼˜ç§€

#ä¸Šè¿°awkå†™æ³•ä¸­çš„printä¹Ÿå¯ä»¥å•ç‹¬å†™åœ¨ä¸€ä¸ªå¤§æ‹¬å·ä¸­
awk '{res=$2>90?"ä¼˜ç§€":"ä¸ä¼˜ç§€"}{print $1,res}' t.txt


#å¯ä»¥ä½¿ç”¨ä¸‰å…ƒè¿ç®—ç¬¦ç»Ÿè®¡ä¸ªæ•°
//ä¸‰å…ƒè¿ç®—å†™æ³•äºŒ		æ¡ä»¶ ï¼Ÿ è¡¨è¾¾å¼1 ï¼š è¡¨è¾¾å¼2
[root@test1 ~]# awk '{$2>90?a++:b++}END{print a,b}' t.txt 
3 2
aè¡¨ç¤ºç¬¦åˆæ¡ä»¶çš„ï¼Œbè¡¨ç¤ºä¸ç¬¦åˆæ¡ä»¶çš„ï¼Œå¤§äº90åˆ†çš„æœ‰3ä¸ªï¼Œä½äº90åˆ†çš„æœ‰2ä¸ª
```

**è‡³ä»Šæ²¡æ‡‚çš„ä¸€é“é¢˜ğŸ¦™ğŸ¦™ğŸ¦™**

```python
æ–‡ä»¶å†…å®¹
[root@test1 ~]# cat lessons.txt 
634751 é¢„æ’
568688 é¢„æ’
386760 åˆ é™¤
619373 é¢„æ’
428491 é¢„æ’
487563 å®Œæˆ
603342 å®Œæˆ
436339 å®Œæˆ
ç»“æœï¼š
åˆ é™¤  386760
å®Œæˆ  487563,603342,436339
é¢„æ’  634751,568688,619373,428491

[root@test1 ~]# awk '{a[$2]=a[$2]" "$1}END{for(i in a) print i,a[i]}' lessons.txt
åˆ é™¤  386760
å®Œæˆ  487563 603342 436339
é¢„æ’  634751 568688 619373 428491

[root@test1 ~]# awk '{a[$2]=a[$2]","$1}END{for(i in a) print i,a[i]}' lessons.txt
åˆ é™¤ ,386760
å®Œæˆ ,487563,603342,436339
é¢„æ’ ,634751,568688,619373,428491

æ–¹æ³•ä¸€
[root@test1 ~]# awk '{a[$2]=a[$2]?a[$2]","$1:a[$2]$1}END{for(i in a) print i,a[i]}' lessons.txt
åˆ é™¤ 386760
å®Œæˆ 487563,603342,436339
é¢„æ’ 634751,568688,619373,428491

æ–¹æ³•äºŒ
[root@test1 ~]# awk '{if(a[$2]){a[$2]=a[$2]","$1}else{a[$2]=a[$2]$1}}END{for(i in a) print i,a[i]}' lessons.txt
åˆ é™¤ 386760
å®Œæˆ 487563,603342,436339
é¢„æ’ 634751,568688,619373,428491
```

