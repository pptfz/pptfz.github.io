# Rocky Linux 10 æ—¶é—´åŒæ­¥ä¸è™šæ‹Ÿæœºä¼‘çœ æ—¶é—´æ¼‚ç§»é—®é¢˜ç¬”è®°

## ä¸€ã€èƒŒæ™¯è¯´æ˜

åœ¨ Rocky Linux 10 ä¸­ï¼Œç³»ç»Ÿ**é»˜è®¤ä¸å†æä¾› `ntpdate` å‘½ä»¤**ï¼Œæ—¶é—´åŒæ­¥ç»Ÿä¸€ç”± **chronyï¼ˆchronyd / chronycï¼‰** è´Ÿè´£ã€‚

åœ¨**è™šæ‹Ÿæœºç¯å¢ƒ**ï¼ˆå¦‚ Parallels Desktopã€VMwareã€VirtualBoxï¼‰ä¸­ï¼Œå¦‚æœ **å®¿ä¸»æœºè¿›å…¥ä¼‘çœ  / æŒ‚èµ·**ï¼š

- è™šæ‹Ÿæœº CPU ä¼šè¢«æš‚åœ
- è™šæ‹Ÿæœºå†…éƒ¨æ—¶é—´ä¸å†æµé€
- å”¤é†’åï¼Œè™šæ‹Ÿæœºæ—¶é—´ä»åœç•™åœ¨ä¼‘çœ å‰

è¿™åœ¨ K8s èŠ‚ç‚¹ã€æ•°æ®åº“ã€æ—¥å¿—ç³»ç»Ÿä¸­ä¼šå¼•å‘ä¸¥é‡é—®é¢˜ã€‚

---

## äºŒã€é—®é¢˜ç°è±¡

å…¸å‹è¡¨ç°ï¼š

- å®¿ä¸»æœºçœŸå®æ—¶é—´ï¼š`2025-12-18`
- è™šæ‹Ÿæœºæ—¶é—´ä»ä¸ºï¼š`2025-12-17`
- `chronyc -a makestep` è¿”å› `200 OK`ï¼Œä½†æ—¶é—´æœªä¿®æ­£
- cron ä¸­å·²é…ç½®æ—¶é—´åŒæ­¥ä»»åŠ¡ï¼Œä½†æ— æ•ˆ

---

## ä¸‰ã€æ ¹æœ¬åŸå› åˆ†æ

### 1. è™šæ‹Ÿæœºä¼‘çœ å¯¼è‡´æ—¶é’Ÿå†»ç»“

å®¿ä¸»æœºä¼‘çœ æœŸé—´ï¼š
- è™šæ‹Ÿæœº vCPU åœæ­¢
- guest OS å†…æ ¸æ—¶é’Ÿå†»ç»“
- å”¤é†’åä¸ä¼šè‡ªåŠ¨è¿½èµ¶çœŸå®æ—¶é—´

---

### 2. Rocky 10 ä¸­ chrony çš„é»˜è®¤è¡Œä¸º

chrony çš„è®¾è®¡åŸåˆ™ï¼š

- **å°åå·®**ï¼šå¹³æ»‘è°ƒæ•´ï¼ˆslewï¼‰
- **å¤§åå·®**ï¼šåªåœ¨ç‰¹å®šæ¡ä»¶ä¸‹è·³å˜ï¼ˆstepï¼‰

Rocky 10 é»˜è®¤é…ç½®ï¼š
```conf
makestep 1.0 3
```

å«ä¹‰ï¼š
- åå·® > 1 ç§’æ‰å…è®¸ step
- **åªåœ¨å‰ 3 æ¬¡æ—¶é—´æ›´æ–°æ—¶å…è®¸ step**

ğŸ‘‰ ç³»ç»Ÿè¿è¡Œä¸€æ®µæ—¶é—´åï¼Œå³ä½¿æ—¶é—´å·®ä¸€å¤©ï¼Œä¹Ÿ**ç¦æ­¢è‡ªåŠ¨ step**ã€‚

---

## å››ã€ä¸ºä»€ä¹ˆ `ntpdate` ä¸å­˜åœ¨äº†

- RHEL 9 / Rocky 9+ å¼€å§‹ **å½»åº•ç§»é™¤ ntpdate**
- åŸå› ï¼š
  - ntpdate ä¼šç²—æš´ä¿®æ”¹ç³»ç»Ÿæ—¶é—´
  - ä¸ç°ä»£æ—¶é—´åŒæ­¥æœºåˆ¶å†²çª
- å®˜æ–¹æ›¿ä»£æ–¹æ¡ˆï¼š
  - `chronyc makestep`
  - `chronyc burst`

---

## äº”ã€å…³é”®å‘½ä»¤è§£é‡Šï¼ˆæ ¸å¿ƒï¼‰

### 1ï¸âƒ£ `chronyc -a 'burst 4/4'`

ä½œç”¨ï¼š
- ç«‹å³å‘ NTP æœåŠ¡å™¨å‘é€ä¸€ç»„è¯·æ±‚
- å¼ºåˆ¶è·å–**æœ€æ–°çœŸå®æ—¶é—´**

é€‚ç”¨åœºæ™¯ï¼š
- è™šæ‹Ÿæœºåˆšä»ä¼‘çœ å”¤é†’
- chrony å°šæœªæ›´æ–° offset

---

### 2ï¸âƒ£ `chronyc -a makestep`

ä½œç”¨ï¼š
- å½“æ—¶é—´åå·®è¿‡å¤§æ—¶
- **ç›´æ¥è·³å˜ç³»ç»Ÿæ—¶é—´ï¼ˆstepï¼‰**

è¯´æ˜ï¼š
- ç®¡ç†å‘˜æ‰‹åŠ¨æ‰§è¡Œçš„ makestep
- **ä¸å— `chrony.conf` ä¸­ step æ¬¡æ•°é™åˆ¶**

---

### 3ï¸âƒ£ ç»„åˆæ‹³ï¼ˆæ¨èè®°ä½ï¼‰

```bash
chronyc -a 'burst 4/4' && chronyc -a makestep
```

ğŸ‘‰ ä¸“æ²»ï¼š
- è™šæ‹Ÿæœºä¼‘çœ 
- å¿«ç…§æ¢å¤
- æ—¶é—´å†»ç»“

---

## å…­ã€æ­£ç¡®çš„ chrony é…ç½®ï¼ˆå¼ºçƒˆæ¨èï¼‰

### ä¿®æ”¹é…ç½®æ–‡ä»¶

```bash
vi /etc/chrony.conf
```

å°†ï¼š
```conf
makestep 1.0 3
```

æ”¹ä¸ºï¼š
```conf
makestep 1.0 -1
```

å«ä¹‰ï¼š
- åå·® > 1 ç§’å°± step
- **ç³»ç»Ÿè¿è¡ŒæœŸé—´å§‹ç»ˆå…è®¸ step**

---

### é‡å¯æœåŠ¡

```bash
systemctl restart chronyd
```

---

## ä¸ƒã€cron æ—¶é—´åŒæ­¥çš„æ­£ç¡®å§¿åŠ¿

### âŒ ä¸æ¨è

```cron
*/10 * * * * chronyc -a makestep
```

åŸå› ï¼š
- makestep ä¸ä¼šä¸»åŠ¨æ‹‰å–æœ€æ–°æ—¶é—´
- offset è¿‡æœŸæ—¶å¯èƒ½ä»€ä¹ˆéƒ½ä¸åš

---

### âœ… æ¨èï¼ˆå…œåº•æ–¹æ¡ˆï¼‰

```cron
*/10 * * * * /usr/bin/chronyc -a 'burst 4/4' && /usr/bin/chronyc -a makestep >/dev/null 2>&1
```

è¯´æ˜ï¼š
- burst å…ˆè·å–çœŸå®æ—¶é—´
- makestep å†å†³å®šæ˜¯å¦è·³å˜

---

## å…«ã€è™šæ‹ŸåŒ–å¹³å°æ—¶é—´åŒæ­¥ï¼ˆå¯é€‰ä½†æ¨èï¼‰

ä»¥ **Parallels Desktop** ä¸ºä¾‹ï¼š

- è™šæ‹Ÿæœºè®¾ç½® â†’ Options â†’ Time
- å‹¾é€‰ï¼š**Sync time with host**

å¹¶åœ¨è™šæ‹Ÿæœºä¸­ç¡®è®¤ï¼š
```bash
systemctl status prl-tools
```

---

## ä¹ã€å¸¸ç”¨æ’æŸ¥å‘½ä»¤

```bash
chronyc tracking
timedatectl
```

é‡ç‚¹å…³æ³¨ï¼š
- `System clock synchronized: yes`
- `System time` åå·®æ˜¯å¦æ¥è¿‘ 0

---

## åã€æœ€ä½³å®è·µæ€»ç»“

- Rocky Linux 10 **ä¸ä½¿ç”¨ ntpdate**
- chrony æ˜¯å”¯ä¸€å®˜æ–¹æ—¶é—´åŒæ­¥æ–¹æ¡ˆ
- è™šæ‹Ÿæœºç¯å¢ƒ **å¿…é¡»å…è®¸ makestep æ°¸ä¹…åœ¨çº¿**
- æ¨èé…ç½®ï¼š
  ```conf
  makestep 1.0 -1
  ```
- é‡åˆ°æ—¶é—´å†»ç»“ï¼š
  ```bash
  chronyc -a 'burst 4/4' && chronyc -a makestep
  ```

---

## ä¸€å¥è¯ç»“è®ºï¼ˆé¢è¯• / ç¬”è®°ç‰ˆï¼‰

> Rocky Linux 10 ä½¿ç”¨ chrony æ›¿ä»£ ntpdateï¼Œè™šæ‹Ÿæœºä¼‘çœ ä¼šå¯¼è‡´ç³»ç»Ÿæ—¶é’Ÿå†»ç»“ï¼Œéœ€é€šè¿‡ `makestep 1.0 -1` æˆ– burst + makestep å¼ºåˆ¶ä¿®æ­£æ—¶é—´ï¼Œå¦åˆ™ chrony é»˜è®¤ç¦æ­¢å¤§å¹…æ—¶é—´è·³å˜ã€‚