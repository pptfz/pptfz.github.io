# 接口响应时间分位数监控+告警



[阿里云性能监控指标](https://help.aliyun.com/document_detail/2536110.html?spm=a2c4g.11186623.help-menu-2362200.d_1_4_3_1.5fab1cdaZIBLj1)

[腾讯云sql案例](https://cloud.tencent.com/document/product/614/103751#f10ba491-6c8e-4417-b703-de0c88ab1919)



## 接口响应时间分位数监控



原始日志条目

```shell
CogTTS首次响应时间: 2025-08-21 16:53:20.808, 耗时 533 毫秒
```



查询语法

```sql
content:"CogTTS首次响应时间"  | select 
APPROX_PERCENTILE(cast(regexp_extract(content, '耗时 (\d+) 毫秒', 1) as double), 0.99) AS p99,
APPROX_PERCENTILE(cast(regexp_extract(content, '耗时 (\d+) 毫秒', 1) as double), 0.90) AS p90,
APPROX_PERCENTILE(cast(regexp_extract(content, '耗时 (\d+) 毫秒', 1) as double), 0.80) AS p80,
APPROX_PERCENTILE(cast(regexp_extract(content, '耗时 (\d+) 毫秒', 1) as double), 0.70) AS p70,
APPROX_PERCENTILE(cast(regexp_extract(content, '耗时 (\d+) 毫秒', 1) as double), 0.5) AS p50,
    histogram(__TIMESTAMP__,INTERVAL 5 minute) as time
    group by time  limit 10000
```





效果如下

![iShot_2025-08-21_16.55.18](https://raw.githubusercontent.com/pptfz/picgo-images/master/img/iShot_2025-08-21_16.55.18.png)



## 接口响应时间分位数告警

### 设置执行语句

```sql
content:"CogTTS首次响应时间"  | select 
APPROX_PERCENTILE(cast(regexp_extract(content, '耗时 (\d+) 毫秒', 1) as double), 0.99) AS p99
 limit 10000 
```



![iShot_2025-08-21_18.42.50](https://raw.githubusercontent.com/pptfz/picgo-images/master/img/iShot_2025-08-21_18.42.50.png)



### 设置触发条件

![iShot_2025-08-21_18.44.28](https://raw.githubusercontent.com/pptfz/picgo-images/master/img/iShot_2025-08-21_18.44.28.png)



### 设置告警通知

![iShot_2025-08-21_18.45.50](https://raw.githubusercontent.com/pptfz/picgo-images/master/img/iShot_2025-08-21_18.45.50.png)



















